// modules/ai/prompts/category-prompts.js
// Category-Specific Prompts and Rules

/**
 * Get category-specific rules based on item data
 */
export function getCategorySpecificRules(itemData) {
  const category = itemData.category?.toLowerCase() || '';
  const title = itemData.title?.toLowerCase() || '';
  const description = itemData.description?.toLowerCase() || '';
  
  // Detect weapons and militaria - expanded detection
  const isWeapon = category.includes('vapen') || 
                  category.includes('sv√§rd') || 
                  category.includes('kniv') || 
                  category.includes('bajonett') || 
                  category.includes('militaria') ||
                  category.includes('krigshistoria') ||
                  title.includes('sv√§rd') || 
                  title.includes('bajonett') || 
                  title.includes('kniv') ||
                  title.includes('dolk') ||
                  title.includes('yxa') ||
                  title.includes('spjut') ||
                  title.includes('gev√§r') ||
                  title.includes('pistol') ||
                  title.includes('uniformsdelar') ||
                  title.includes('hj√§lm') ||
                  description.includes('vapen') ||
                  description.includes('milit√§r') ||
                  description.includes('sv√§rdsskola') ||
                  description.includes('sv√§rdsmed') ||
                  description.includes('signerad') && (description.includes('fujiwara') || description.includes('takada'));
  
  if (isWeapon) {
    return WEAPON_RULES;
  }
  
  // Detect watches/timepieces
  const isWatch = category.includes('armbandsur') || 
                 category.includes('klocka') || 
                 title.includes('armbandsur') || 
                 title.includes('klocka') ||
                 description.includes('armbandsur') ||
                 description.includes('klocka');
  
  if (isWatch) {
    return WATCH_RULES;
  }
  
  // Detect historical/cultural artifacts that need conservative handling
  const isHistoricalItem = category.includes('antikviteter') ||
                          category.includes('arkeologi') ||
                          category.includes('etnografika') ||
                          category.includes('historiska') ||
                          category.includes('kulturhistoria') ||
                          title.includes('antik') ||
                          title.includes('historisk') ||
                          title.includes('forntid') ||
                          title.includes('medeltid') ||
                          title.includes('vikinga') ||
                          title.includes('brons√•lder') ||
                          description.includes('antik') ||
                          description.includes('historisk') ||
                          description.includes('kulturell') ||
                          description.includes('arkeologisk');
  
  if (isHistoricalItem) {
    return HISTORICAL_RULES;
  }
  
  // Detect jewelry that might have complex gemological terms
  const isJewelry = category.includes('smycken') ||
                   category.includes('guld') ||
                   category.includes('silver') ||
                   category.includes('diamant') ||
                   category.includes('√§delsten') ||
                   title.includes('ring') ||
                   title.includes('halsband') ||
                   title.includes('armband') ||
                   title.includes('brosch') ||
                   title.includes('√∂rh√§ngen') ||
                   description.includes('karat') ||
                   description.includes('√§delsten') ||
                   description.includes('rubin') ||
                   description.includes('safir') ||
                   description.includes('smaragd');
  
  if (isJewelry) {
    return JEWELRY_RULES;
  }
  
  return '';
}

/**
 * Weapon and militaria specific rules
 */
const WEAPON_RULES = `
KATEGORI-SPECIFIK REGEL - VAPEN OCH MILITARIA:
Detta √§r ett vapen eller milit√§rt f√∂rem√•l. EXTRA F√ñRSIKTIGHET kr√§vs f√∂r att undvika historiska felaktigheter och AI-hallucinationer.

üö® KRITISKA ANTI-HALLUCINATION REGLER F√ñR VAPEN:

F√ñRBJUDNA TILL√ÑGG - L√ÑG ALDRIG TILL:
‚Ä¢ Historisk kontext som inte explicit finns i k√§llan (t.ex. "under Enp≈ç-perioden")
‚Ä¢ Skolnamn eller regionnamn som inte √§r explicit n√§mnda (t.ex. "Bungo-skolan", "Bungo-regionen")
‚Ä¢ Generaliseringar fr√•n specifika namn (t.ex. fr√•n "Takada" till "Takada-skolan i Bungo-regionen")
‚Ä¢ Biografisk information om sv√§rdssmeder eller vapensmeder
‚Ä¢ Produktionstekniker eller traditioner som inte √§r n√§mnda
‚Ä¢ Tidsperioder baserade p√• stilanalys eller gissningar
‚Ä¢ Karakteristiska drag eller kvalitetsbed√∂mningar

ENDAST TILL√ÖTET - F√ñRB√ÑTTRA BEFINTLIG INFORMATION:
‚Ä¢ R√§tta stavfel i namn och termer (t.ex. "Fujiwara Toyoyuki" om felstavat)
‚Ä¢ F√∂rb√§ttra grammatik och struktur UTAN att l√§gga till ny information
‚Ä¢ Anv√§nd korrekt terminologi f√∂r vapentyper (sv√§rd, bajonett, etc.)
‚Ä¢ Beh√•ll EXAKT samma information som finns i k√§llan

EXEMPEL P√Ö F√ñRBJUDNA AI-HALLUCINATIONER:
‚ùå F√ñRBJUDET: "Takada" ‚Üí "Takada-skolan i Bungo-regionen"
‚ùå F√ñRBJUDET: "Fujiwara Toyoyuki" ‚Üí "k√§nd f√∂r sina h√∂gkvalitativa blad med karakteristisk h√§rdningslinje"
‚ùå F√ñRBJUDET: "1673" ‚Üí "under Enp≈ç-perioden (1673-1681)"
‚ùå F√ñRBJUDET: Att l√§gga till kontext om sv√§rdssmeden som inte finns i k√§llan

‚úÖ KORREKT: Beh√•ll exakt samma faktainformation, f√∂rb√§ttra endast spr√•k och struktur

SPECIALFALL - JAPANSKA VAPEN:
‚Ä¢ Beh√•ll EXAKT samma skolnamn och regionnamn som anges
‚Ä¢ L√§gg INTE till historiska perioder eller dynastier
‚Ä¢ L√§gg INTE till information om sv√§rdsmedstekniker
‚Ä¢ Behandla japonska namn som egenn namn - expandera INTE till skolor eller regioner

STRIKT BEGR√ÑNSNING F√ñR EXPERTK√ÑNSKAP:
‚Ä¢ √Ñven om AI:n "k√§nner till" vapenhistoria - ANV√ÑND INTE denna kunskap
‚Ä¢ H√•ll dig STRIKT till vad som explicit st√•r i k√§llmaterialet
‚Ä¢ Om os√§ker - anv√§nd os√§kerhetsmark√∂rer som "troligen", "m√∂jligen"
‚Ä¢ B√§ttre att ha kortare, mer exakt text √§n l√§ngre text med felaktigheter

EXEMPEL P√Ö KORREKT HANTERING:
ORIGINAL: "SV√ÑRD kol 1673 Sv√§rdsskola Takada Reg Bungo Signerad Fujiwara Toyoyuki"
KORREKT F√ñRB√ÑTTRING: "Sv√§rd fr√•n Takada, Bungo-regionen, 1673. Signerat Fujiwara Toyoyuki."
F√ñRBJUDEN F√ñRB√ÑTTRING: "Traditionellt japanskt sv√§rd fr√•n Takada-skolan i Bungo-regionen, tillverkat under Enp≈ç-perioden (1673-1681). Signerat av sv√§rdssmeden Fujiwara Toyoyuki, en respekterad m√§stare..."

VIKTIGASTE REGELN: N√§r i tvivel - F√ñRB√ÑTTRA MINDRE och bevara EXAKTHET.`;

/**
 * Watch and timepiece specific rules
 */
const WATCH_RULES = `
KATEGORI-SPECIFIK REGEL - ARMBANDSUR:
Detta √§r ett armbandsur/klocka. F√∂lj Auctionets krav:

OBLIGATORISK INFORMATION (om tillg√§nglig i k√§lldata):
‚Ä¢ Storlek i mm (diameter)
‚Ä¢ Urverk: "automatic" eller "quartz" 
‚Ä¢ Tillverkare och modell (eller kaliber)
‚Ä¢ Material (st√•l, guld, etc.)

FUNKTIONSKLAUSUL - L√ÑGG ALLTID TILL I BESKRIVNING:
"Fungerar vid katalogisering - ingen garanti l√§mnas p√• funktion."

KRITISKT F√ñR ARMBANDSUR TITEL:
‚Ä¢ BEH√ÖLL ALLTID "ARMBANDSUR" F√ñRST i titeln
‚Ä¢ Format: "ARMBANDSUR, [material], [tillverkare], [modell], [urverk], [storlek], [period]"
‚Ä¢ EXEMPEL: "ARMBANDSUR, st√•l, ROLEX, Submariner, automatic, 40mm, 1990-tal"

EXEMPEL P√Ö KORREKT FORMAT:
TITEL: "ARMBANDSUR, st√•l, ROLEX, Submariner, automatic, 40mm, 1990-tal"
BESKRIVNING: "Automatiskt armbandsur i rostfritt st√•l. Svart urtavla med lysande index. Fungerar vid katalogisering - ingen garanti l√§mnas p√• funktion."

KRITISKA REGLER F√ñR ARMBANDSUR:
‚Ä¢ BEH√ÖLL "ARMBANDSUR" som f√∂rsta ord i titel - TA ALDRIG BORT
‚Ä¢ L√§gg INTE till m√•tt (mm) som inte finns i k√§lldata
‚Ä¢ L√§gg INTE till urverk (automatic/quartz) som inte √§r angivet
‚Ä¢ R√ÑTTA stavfel i m√§rken/modeller (t.ex. "Oscean" ‚Üí "Ocean")
‚Ä¢ F√∂rb√§ttra ENDAST befintlig information - uppfinn INGET nytt

ANTI-HALLUCINATION: Om storlek, urverk eller andra tekniska detaljer INTE finns i originalet - l√§gg INTE till dem.`;

/**
 * Historical items specific rules
 */
const HISTORICAL_RULES = `
KATEGORI-SPECIFIK REGEL - HISTORISKA F√ñREM√ÖL OCH ANTIKVITETER:
Detta √§r ett historiskt/kulturellt f√∂rem√•l. Anv√§nd KONSERVATIV f√∂rst√§rkning f√∂r att undvika felaktiga historiska tolkningar.

KONSERVATIVA REGLER:
‚Ä¢ L√§gg INTE till historiska perioder eller dynastier som inte √§r explicit n√§mnda
‚Ä¢ Expandera INTE kulturella eller geografiska referenser utan k√§lla
‚Ä¢ Undvik arkeologiska eller historiska spekulationer
‚Ä¢ Behandla alla historiska namn och platser som exakta citat
‚Ä¢ Anv√§nd os√§kerhetsmark√∂rer vid minsta tvivel: "troligen", "m√∂jligen"

ANTI-HALLUCINATION:
‚Ä¢ Uppfinn ALDRIG historisk kontext eller bakgrund
‚Ä¢ Ut√∂ka INTE geografiska eller kulturella referenser
‚Ä¢ L√§gg INTE till datering baserad p√• stilanalys
‚Ä¢ Beh√•ll EXAKT samma historiska referenser som i k√§llan`;

/**
 * Jewelry and precious items specific rules
 */
const JEWELRY_RULES = `
KATEGORI-SPECIFIK REGEL - SMYCKEN OCH √ÑDELMETALLER:
Detta √§r ett smycke eller f√∂rem√•l i √§delmetall. Var F√ñRSIKTIG med tekniska specifikationer.

TEKNISKA BEGR√ÑNSNINGAR:
‚Ä¢ L√§gg INTE till karattyngd som inte √§r angiven
‚Ä¢ Specificera INTE metallhalt (18k, 14k) utan k√§lla
‚Ä¢ L√§gg INTE till information om √§delstenars kvalitet eller ursprung
‚Ä¢ Uppfinn INTE tekniska detaljer om legering eller bearbetning
‚Ä¢ Beh√•ll EXAKT samma tekniska information som finns i k√§llan

ENDAST F√ñRB√ÑTTRA:
‚Ä¢ Stavning av √§delstensnamn och m√§rken
‚Ä¢ Grammatik och struktur
‚Ä¢ Korrekt smyckesterminologi
‚Ä¢ Spr√•k och l√§sbarhet utan att l√§gga till tekniska detaljer`;

/**
 * Check if item belongs to specialized category
 */
export function isSpecializedCategory(itemData) {
  const category = itemData.category?.toLowerCase() || '';
  const title = itemData.title?.toLowerCase() || '';
  const description = itemData.description?.toLowerCase() || '';
  
  // Check for specialized categories that need conservative enhancement
  const specializedKeywords = [
    // Weapons and militaria
    'vapen', 'sv√§rd', 'kniv', 'bajonett', 'militaria', 'krigshistoria',
    'dolk', 'yxa', 'spjut', 'gev√§r', 'pistol', 'uniformsdelar', 'hj√§lm',
    'milit√§r', 'sv√§rdsskola', 'sv√§rdsmed',
    // Historical items
    'antikviteter', 'arkeologi', 'etnografika', 'historiska', 'kulturhistoria',
    'antik', 'historisk', 'forntid', 'medeltid', 'vikinga', 'brons√•lder',
    'kulturell', 'arkeologisk',
    // Jewelry and precious items
    'smycken', 'guld', 'silver', 'diamant', '√§delsten',
    'ring', 'halsband', 'armband', 'brosch', '√∂rh√§ngen',
    'karat', 'rubin', 'safir', 'smaragd'
  ];
  
  return specializedKeywords.some(keyword => 
    category.includes(keyword) || 
    title.includes(keyword) || 
    description.includes(keyword)
  );
} 